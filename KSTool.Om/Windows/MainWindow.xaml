<Window
    x:Class="KSTool.Om.Windows.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:local="clr-namespace:KSTool.Om.Windows"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:KSTool.Om.Core.Models;assembly=KSTool.Om.Core"
    xmlns:userControls="clr-namespace:KSTool.Om.UserControls"
    Title="{Binding Project, Converter={StaticResource TitleConverter}}"
    Width="1200"
    Height="900"
    d:DataContext="{d:DesignInstance local:MainWindowViewModel,
                                     IsDesignTimeCreatable=False}"
    Background="{StaticResource SecondaryRegionBrush}"
    Closed="MainWindow_OnClosed"
    Closing="MainWindow_OnClosing"
    FontSize="13"
    TextBlock.Foreground="{StaticResource PrimaryTextBrush}"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <DockPanel>
            <Menu DockPanel.Dock="Top" FontSize="13">
                <MenuItem Header="_File">
                    <MenuItem Click="miCreateProject_OnClick" Header="_New Project..." />
                    <MenuItem Click="miOpenProject_OnClick" Header="_Open Project" />
                    <Separator />
                    <MenuItem
                        Click="miSaveProject_OnClick"
                        Header="_Save"
                        IsEnabled="{Binding Project, Converter={StaticResource IsNullToIsEnabledConverter}}" />
                    <Separator />
                    <MenuItem
                        Click="miOpenBeatmapFolder_OnClick"
                        Header="Open _Beatmap Folder"
                        IsEnabled="{Binding Project, Converter={StaticResource IsNullToIsEnabledConverter}}" />
                    <Separator />
                    <MenuItem Click="miExit_OnClick" Header="_Exit" />
                </MenuItem>
                <MenuItem Header="_View">
                    <MenuItem Header="_Category Manager" IsChecked="True" />
                </MenuItem>
                <MenuItem Header="_Tool">
                    <MenuItem Header="_Template Helper..." />
                </MenuItem>
            </Menu>
        </DockPanel>
        <Grid
            Grid.Row="1"
            Margin="10"
            Visibility="{Binding Project, Converter={StaticResource IsNullToVisibilityConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="400" />
                <ColumnDefinition Width="700" MinWidth="270" />
            </Grid.ColumnDefinitions>
            <userControls:TimelineViewer
                x:Name="timelineViewer"
                Grid.Column="0"
                Margin="5,5,20,5" />
            <GridSplitter
                Grid.Column="0"
                Width="5"
                Margin="0,-10"
                Background="{StaticResource RegionBrush}" />
            <StackPanel
                Grid.Column="1"
                Margin="15,5,5,5"
                HorizontalAlignment="Left"
                Orientation="Vertical">
                <TextBlock
                    Margin="0,5"
                    FontSize="14"
                    Text="Current Difficulty" />
                <ComboBox
                    Width="250"
                    Margin="0,5"
                    ItemsSource="{Binding Project.Difficulties}"
                    SelectedItem="{Binding Project.CurrentDifficulty}"
                    SelectionChanged="Selector_OnSelectionChanged">
                    <ComboBox.ItemTemplate>
                        <DataTemplate DataType="models:ProjectDifficulty">
                            <TextBlock Text="{Binding DifficultyName}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>
        </Grid>

        <Border
            x:Name="bdrLoadingCover"
            Grid.Row="1"
            d:IsHidden="True"
            Background="{StaticResource RegionBrush}"
            Visibility="{Binding IsLoading, Converter={StaticResource Boolean2VisibilityConverter}}">
            <StackPanel VerticalAlignment="Center">
                <hc:LoadingCircle HorizontalAlignment="Center" IsRunning="{Binding IsLoading}" />
                <TextBlock
                    Margin="0,10"
                    HorizontalAlignment="Center"
                    FontSize="24"
                    Foreground="{StaticResource SecondaryTextBrush}"
                    Text="Loading Project..." />
            </StackPanel>
        </Border>
    </Grid>
</Window>
